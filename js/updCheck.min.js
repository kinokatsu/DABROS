var svrdt,svrno,checkInterval,timer1,targetBtnMainObj,targetBtnReloadObj,targetInpObj1,targetInpObj2,ptyp,jQ=jQuery,maInt=3e4,NCInt=1.5e6,ajaxTO=2e3;$(document).ready(function(){setObject();console.log(document.URL);console.log("Load - "+formatDate(new Date,"yyyy/MM/dd HH:mm:ss"));if(typeof window.console==="undefined")window.console={};if(typeof window.console.log!=="function")window.console.log=function(){};if(typeof window.console.log!=="function")window.console.log=function(){}});function setObject(){var a=document.URL;if(a.includes("main")===true){targetBtnMainObj=$("#ctl00_CntplHolder_btnSubmit");targetBtnReloadObj=$("#ctl00_CntplHolder_btnSubmit");targetInpObj1=$("#ctl00_CntplHolder_nwdt");targetInpObj2=$("#ctl00_CntplHolder_nwdtno");checkInterval=maInt;ptyp=-1}svrdt=targetInpObj1.val();svrno=targetInpObj2.val();if(svrdt.includes("NC")===true)checkInterval=NCInt;timer1=setInterval(dtchk,checkInterval)}var dtchk=function(){$("#imgloader").show();svrdt=targetInpObj1.val();svrno=targetInpObj2.val();console.log("------");console.log("ajax---- "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss")+" -> "+svrno);console.log("window.name = "+window.name);jQ.ajax({async:true,type:"GET",dataType:"text",scriptCharset:"utf-8",url:"./api/UpdCheck.ashx",data:"i="+svrno,cache:false,timeout:ajaxTO}).done(function(a,b,c){console.log("textStatus- "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss")+" -> "+b);console.log("jqXHR- "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss")+" -> "+c);console.log("GetDate- "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss")+" -> "+a);if(a.includes("DataEr")===true){console.log("DataError - SubButton Click - "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss"));clearInterval(timer1);targetBtnReloadObj.click()}else if(compareDate(a)){console.log("Update - MainButton Click - "+formatDate(new Date,"yyyy/MM/ss HH:mm:ss"));ptyp===0&&clearInterval(timer1);targetBtnMainObj.click()}$("#imgloader").hide()}).fail(function(a){console.log("fail! "+a.statusText+", status="+a.status+", Response="+a.responseText);var b=a.responseText;if(b==null)$("#imgloader").hide();else if(b.includes("Unauthorized")===true&&document.URL.includes("main")===true){clearInterval(timer1);if(ptyp===-1){alert("\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u5207\u65ad\u3055\u308c\u305f\u305f\u3081\u3001\u66f4\u65b0\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u304a\u624b\u6570\u3092\u304a\u304b\u3051\u3044\u305f\u3057\u307e\u3059\u304c\u3001\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");targetBtnMainObj.click()}}else $("#imgloader").hide()})};function compareDate(j){var k=0,i=0,d,c,e=svrdt.split(","),b=j.split(","),f=false,a;console.log("URL -- "+document.URL);for(a=0;a<b.length;a++){if(svrdt.includes("NC")===true){console.log("No check site.");console.log("-"+formatDate(new Date,"yyyy/MM/dd HH:mm:ss"));break}var h=e[a].split(" ");if(CheckDate(h[0])&&CheckTime(h[1])){d=new Date(e[a]);k=1}var g=b[a].split(" ");if(CheckDate(g[0])&&CheckTime(g[1])){c=new Date(b[a]);i=1}if(k===1&&i===1){console.log(a+" "+checkInterval);console.log("Hidden-"+formatDate(d,"yyyy/MM/dd HH:mm:ss"));console.log("Get----"+formatDate(c,"yyyy/MM/dd HH:mm:ss"));if(d<c){f=true;targetInpObj1.val([j]);break}}}return f}function CheckDate(c){var a=c.split("/");if(a.length!==3)return false;var b=new Date(a[0],a[1]-1,a[2]);return a[0]!==String(b.getFullYear())||a[1]!==("0"+(b.getMonth()+1)).slice(-2)||a[2]!==("0"+b.getDate()).slice(-2)?false:true}function CheckTime(a){return a.match(/^([01]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/)!==null}function addMessage(e){var a=new Date,b=("0"+a.getHours().toString()).substr(-2),d=("0"+a.getMinutes().toString()).substr(-2),f=("0"+a.getSeconds().toString()).substr(-2),c=b+":"+d+":"+f,g=c+" "+e+"\n"}function formatDate(b,a){a=a.replace(/yyyy/g,b.getFullYear());a=a.replace(/MM/g,("0"+(b.getMonth()+1)).slice(-2));a=a.replace(/dd/g,("0"+b.getDate()).slice(-2));a=a.replace(/HH/g,("0"+b.getHours()).slice(-2));a=a.replace(/mm/g,("0"+b.getMinutes()).slice(-2));a=a.replace(/ss/g,("0"+b.getSeconds()).slice(-2));a=a.replace(/SSS/g,("00"+b.getMilliseconds()).slice(-3));return a}function alertDialog(c){var b={title:"",body:"",close:function(){return true}},a=$.extend(b,c,{}),d=$("<div />",{title:a.title,html:a.body});d.dialog({modal:true,close:function(){var b=$(this);b.dialog("destroy");b.remove();a.close()},buttons:[{text:"Ok",click:function(){$(this).dialog("close")}}]})}